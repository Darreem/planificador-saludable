# Generate an improved standalone HTML with color-mapped bars, compact charts, and a quick interpretation list.
html = r"""<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>Planificador Saludable (colores por producto)</title>
  <!-- Tailwind (CDN) -->
  <script src="https://cdn.tailwindcss.com"></script>
  <!-- React & ReactDOM (CDN) -->
  <script crossorigin src="https://unpkg.com/react@18/umd/react.development.js"></script>
  <script crossorigin src="https://unpkg.com/react-dom@18/umd/react-dom.development.js"></script>
  <!-- Babel (to run JSX in the browser) -->
  <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
  <!-- Chart.js v4 -->
  <script src="https://cdn.jsdelivr.net/npm/chart.js@4"></script>
  <style>
    ::-webkit-scrollbar { height: 10px; width: 10px; }
    ::-webkit-scrollbar-thumb { background: #94d3ac; border-radius: 9999px; }
    ::-webkit-scrollbar-track { background: #e6f6ef; }
  </style>
</head>
<body class="min-h-screen bg-gradient-to-br from-lime-50 via-green-50 to-teal-50 text-slate-800">
  <div id="root"></div>

  <script type="text/babel">
    const { useState, useEffect, useRef, useMemo } = React;

    // Utilidades
    const getTodayDate = () => new Date().toISOString().split('T')[0];
    const formatCurrency = (value) => 'S/ ' + (Number(value || 0).toFixed(2));
    const normalize = (str) => (str || '').toLowerCase().trim()
      .normalize('NFD').replace(/[\\u0300-\\u036f]/g, '');

    // ===== Color mapping por producto =====
    // Devuelve un color (o gradiente) "natural" seg√∫n el producto reconocido.
    function getColorForProduct(label, chartCtx) {
      const l = normalize(label);
      // frutas
      if (/(manzana|apple)/.test(l)) return '#ef4444';               // rojo
      if (/(platano|banana|banano)/.test(l)) return '#facc15';        // amarillo
      if (/(sandia|watermelon)/.test(l)) {
        // Gradiente rojo -> verde
        const { ctx, chartArea } = chartCtx.chart;
        if (!chartArea) return '#ef4444';
        const g = ctx.createLinearGradient(0, chartArea.top, 0, chartArea.bottom);
        g.addColorStop(0, '#ef4444'); // rojo
        g.addColorStop(1, '#16a34a'); // verde
        return g;
      }
      if (/(uva|grape|uvas)/.test(l)) return '#7c3aed';               // morado
      if (/(mandarina)/.test(l)) return '#fb923c';                    // naranja vivo
      if (/(naranja)/.test(l)) return '#fdba74';                      // naranja claro
      if (/(pera)/.test(l)) return '#84cc16';                         // verde lima
      if (/(papaya)/.test(l)) return '#f97316';                       // anaranjado
      if (/(melon|melo[√≥o]n)/.test(l)) return '#22c55e';              // verde mel√≥n
      if (/(fresa|strawberry)/.test(l)) return '#f43f5e';             // rojo fresa
      if (/(arandano|ar√°ndano|blueberry)/.test(l)) return '#3b82f6';  // azul
      if (/(limon|lim√≥n)/.test(l)) return '#a3e635';                  // verde lim√≥n

      // verduras
      if (/(tomate)/.test(l)) return '#ef4444';
      if (/(lechuga|espinaca|acelga)/.test(l)) return '#16a34a';
      if (/(zanahoria|carrot)/.test(l)) return '#f59e0b';
      if (/(pimiento|piment[√≥o]n)/.test(l)) return '#ef4444';
      if (/(pepino|cucumber)/.test(l)) return '#16a34a';
      if (/(brocoli|br[√≥o]coli|cabbage)/.test(l)) return '#10b981';

      // fallback paleta profesional (verdes/teales)
      const palette = ['#0ea5e9','#14b8a6','#10b981','#34d399','#6ee7b7','#a7f3d0','#86efac'];
      const i = Math.abs(hashCode(l)) % palette.length;
      return palette[i];
    }

    function hashCode(str) {
      let hash = 0;
      for (let i = 0; i < str.length; i++) {
        hash = ((hash << 5) - hash) + str.charCodeAt(i);
        hash |= 0;
      }
      return hash;
    }

    // Componente Chart.js con altura compacta
    function ChartCanvas({ type = 'line', data, options, height = 220 }) {
      const canvasRef = useRef(null);
      const chartRef = useRef(null);

      useEffect(() => {
        if (!canvasRef.current) return;
        if (chartRef.current) {
          chartRef.current.destroy();
          chartRef.current = null;
        }
        const ctx = canvasRef.current.getContext('2d');
        chartRef.current = new Chart(ctx, {
          type,
          data,
          options: {
            maintainAspectRatio: false,
            ...options,
          },
        });
        return () => chartRef.current && chartRef.current.destroy();
      }, [JSON.stringify(data), JSON.stringify(options), type]);

      return <div style={{height}}><canvas ref={canvasRef} className="w-full"></canvas></div>;
    }

    function App() {
      // Estado
      const [state, setState] = useState(() => {
        const saved = localStorage.getItem('planificadorCompras_v3');
        if (saved) {
          try {
            const parsed = JSON.parse(saved);
            if (parsed.version === '3.0') return parsed;
          } catch {}
        }
        return {
          presupuesto: 150,
          precios: [
            { id: 1, fecha: '2025-08-25', tienda: 'Mercado Local', producto: 'Pl√°tano', unidad: 'kg', cantidad: 2.5, precioTotal: 7.50 },
            { id: 2, fecha: '2025-08-25', tienda: 'Supermercado', producto: 'Manzana', unidad: 'kg', cantidad: 1.5, precioTotal: 9.00 },
            { id: 3, fecha: '2025-08-28', tienda: 'Supermercado', producto: 'Pl√°tano', unidad: 'kg', cantidad: 2, precioTotal: 6.80 },
          ],
          inventario: [
            { id: 1, producto: 'Tomate', fechaCompra: '2025-08-28', fechaVenc: '2025-09-05' },
            { id: 2, producto: 'Lechuga', fechaCompra: '2025-08-28', fechaVenc: '2025-09-02' },
          ],
          listaCompras: [
            { id: 1, producto: 'Pl√°tano', cantidad: 3 },
            { id: 2, producto: 'Manzana', cantidad: 2 },
            { id: 3, producto: 'Zanahoria', cantidad: 1.5 },
          ],
          planSemanal: {
            'Lunes': { desayuno: 'Papaya', almuerzo: 'Ensalada', snacks: 'Manzana' },
            'Martes': { desayuno: 'Pl√°tano', almuerzo: 'Sopa de verduras', snacks: 'Naranja' },
            'Mi√©rcoles': { desayuno: 'Jugo de fresa', almuerzo: 'Tomates rellenos', snacks: 'Pera' },
            'Jueves': { desayuno: 'Avena con ar√°ndanos', almuerzo: 'Ensalada', snacks: 'Pl√°tano' },
            'Viernes': { desayuno: 'Sand√≠a', almuerzo: 'Verduras salteadas', snacks: 'Manzana' },
            'S√°bado': { desayuno: 'Pl√°tano', almuerzo: 'Ensalada de frutas', snacks: 'Mandarina' },
            'Domingo': { desayuno: 'Mel√≥n', almuerzo: 'Pimientos al horno', snacks: 'Uvas' },
          },
          version: '3.0'
        };
      });

      const [tab, setTab] = useState('dashboard');
      const [savedToast, setSavedToast] = useState(false);
      const fileInputRef = useRef(null);

      const saveState = (next) => {
        setState(next);
        localStorage.setItem('planificadorCompras_v3', JSON.stringify(next));
        setSavedToast(true);
        clearTimeout(saveState._t);
        saveState._t = setTimeout(() => setSavedToast(false), 1800);
      };

      // ---- L√≥gica de negocio ----
      const findBestPrice = (producto) => {
        const norm = normalize(producto);
        const relevant = state.precios.filter(p => normalize(p.producto) === norm);
        if (!relevant.length) return { tienda: null, precioUnitario: null };
        const best = relevant.reduce((b, cur) => {
          const curU = (Number(cur.cantidad) > 0) ? Number(cur.precioTotal) / Number(cur.cantidad) : Infinity;
          const bestU = (Number(b.cantidad) > 0) ? Number(b.precioTotal) / Number(b.cantidad) : Infinity;
          return curU < bestU ? cur : b;
        });
        const precioUnitario = (Number(best.cantidad) > 0) ? Number(best.precioTotal) / Number(best.cantidad) : null;
        return { tienda: best.tienda, precioUnitario };
      };

      const calculateTotalEstimado = () => state.listaCompras.reduce((sum, item) => {
        const { precioUnitario } = findBestPrice(item.producto);
        return sum + (Number(item.cantidad) || 0) * (Number(precioUnitario) || 0);
      }, 0);

      const calculateGastoReal = () => {
        const sevenDaysAgo = new Date();
        sevenDaysAgo.setDate(sevenDaysAgo.getDate() - 7);
        return state.precios
          .filter(p => new Date(p.fecha) >= sevenDaysAgo)
          .reduce((sum, p) => sum + Number(p.precioTotal || 0), 0);
      };

      const getDaysRemaining = (fechaVenc) => {
        const today = new Date(getTodayDate());
        const venc = new Date(fechaVenc);
        const diff = venc.getTime() - today.getTime();
        return Math.ceil(diff / (1000 * 60 * 60 * 24));
      };

      const getPriorityInfo = (days) => {
        if (days <= 2) return { cls: 'bg-red-100 text-red-800', text: 'Usar YA' };
        if (days <= 7) return { cls: 'bg-yellow-100 text-yellow-800', text: 'Usar Pronto' };
        return { cls: 'bg-green-100 text-green-800', text: 'OK' };
      };

      // ---- Gr√°ficos (compactos y profesionales) ----
      const last7Dates = () => Array.from({ length: 7 }, (_, i) => {
        const d = new Date();
        d.setDate(d.getDate() - (6 - i));
        return d.toISOString().split('T')[0];
      });

      const chartDataLine = useMemo(() => {
        const days = last7Dates();
        const gastos = days.map(date =>
          state.precios.filter(p => p.fecha === date)
            .reduce((s, p) => s + Number(p.precioTotal || 0), 0)
        );
        return {
          labels: days.map(d => new Date(d).toLocaleDateString('es-PE', { weekday: 'short' })),
          datasets: [{
            label: 'Gastos Diarios (S/)',
            data: gastos,
            borderColor: '#10b981',
            backgroundColor: 'rgba(16,185,129,0.12)',
            tension: 0.35,
            fill: true,
            pointRadius: 2.5,
          }]
        };
      }, [state.precios]);

      const chartOptsLine = {
        plugins: {
          legend: { display: false },
          tooltip: {
            callbacks: {
              label: (ctx) => formatCurrency(ctx.parsed.y),
            }
          }
        },
        scales: {
          y: { beginAtZero: true, grid: { color: 'rgba(0,0,0,0.06)' } },
          x: { grid: { display: false } }
        }
      };

      // dataset de barras con color por producto (scriptable)
      const productosMap = useMemo(() => {
        const map = {};
        state.precios.forEach(pr => {
          const key = (pr.producto || 'Sin nombre').trim();
          map[key] = (map[key] || 0) + Number(pr.precioTotal || 0);
        });
        return map;
      }, [state.precios]);

      const labelsBar = Object.keys(productosMap);
      const dataBar = Object.values(productosMap);

      const chartDataBar = {
        labels: labelsBar,
        datasets: [{
          label: 'Gasto por Producto (S/)',
          data: dataBar,
          // Scriptable backgroundColor seg√∫n etiqueta
          backgroundColor: (ctx) => {
            const label = ctx.chart.data.labels[ctx.dataIndex];
            return getColorForProduct(label, ctx);
          },
          borderColor: 'rgba(0,0,0,0.08)',
          borderWidth: 1,
          borderRadius: 6,
          borderSkipped: false,
          maxBarThickness: 36
        }]
      };

      const chartOptsBar = {
        plugins: {
          legend: { display: false },
          tooltip: {
            callbacks: {
              label: (ctx) => formatCurrency(ctx.parsed.y),
            }
          }
        },
        scales: {
          y: { beginAtZero: true, grid: { color: 'rgba(0,0,0,0.06)' } },
          x: { grid: { display: false } }
        }
      };

      // Interpretaci√≥n r√°pida: Top 5 productos por gasto
      const topProductos = useMemo(() => {
        return Object.entries(productosMap)
          .sort((a,b) => b[1]-a[1])
          .slice(0,5);
      }, [productosMap]);

      // ---- Derivados ----
      const totalEstimado = calculateTotalEstimado();
      const gastoReal = calculateGastoReal();
      const ahorroEstimado = Math.max(0, Number(state.presupuesto || 0) - totalEstimado);

      // ---- CRUD helpers ----
      const updateItem = (listName, id, field, value) => {
        const list = [...state[listName]];
        const idx = list.findIndex(x => x.id === id);
        if (idx >= 0) list[idx] = { ...list[idx], [field]: value };
        saveState({ ...state, [listName]: list });
      };
      const deleteItem = (listName, id) => {
        const list = state[listName].filter(x => x.id !== id);
        saveState({ ...state, [listName]: list });
      };
      const addItem = (listName, defaults) => {
        const list = state[listName];
        const newId = Math.max(0, ...list.map(i => i.id)) + 1;
        saveState({ ...state, [listName]: [...list, { id: newId, ...defaults }] });
      };

      // ---- Export/Import ----
      const exportData = () => {
        const dataStr = JSON.stringify(state, null, 2);
        const blob = new Blob([dataStr], { type: 'application/json' });
        const url = URL.createObjectURL(blob);
        const a = document.createElement('a');
        a.href = url;
        a.download = 'planificador-compras-' + getTodayDate() + '.json';
        document.body.appendChild(a);
        a.click();
        a.remove();
        URL.revokeObjectURL(url);
      };

      const onPickFile = () => fileInputRef.current?.click();

      const onImportFile = (e) => {
        const file = e.target.files?.[0];
        if (!file) return;
        const reader = new FileReader();
        reader.onload = (ev) => {
          try {
            const data = JSON.parse(ev.target.result);
            if (data && data.version && data.precios) {
              if (confirm('Esto reemplazar√° todos tus datos actuales. ¬øContinuar?')) {
                saveState(data);
              }
            } else {
              alert('‚ùå Archivo no v√°lido o corrupto.');
            }
          } catch {
            alert('‚ùå Error al leer el archivo.');
          }
        };
        reader.readAsText(file);
        e.target.value = '';
      };

      const clearAll = () => {
        if (confirm('¬øSeguro que deseas borrar TODOS los datos guardados? Esta acci√≥n no se puede deshacer.')) {
          localStorage.removeItem('planificadorCompras_v3');
          location.reload();
        }
      };

      // ---- UI ----
      return (
        <div className="container mx-auto p-4 md:p-8">
          {savedToast && (
            <div className="fixed top-4 right-4 bg-green-600 text-white px-4 py-2 rounded-lg shadow-lg z-50 animate-pulse">
              ‚úÖ Datos guardados en el navegador
            </div>
          )}

          {/* Header */}
          <header className="text-center mb-6 md:mb-8">
            <div className="flex items-center justify-center gap-3 mb-3 md:mb-4">
              <div className="p-3 bg-gradient-to-br from-green-500 to-emerald-500 rounded-full shadow-lg">
                <span className="text-white text-2xl">üåø</span>
              </div>
              <h1 className="text-3xl md:text-5xl font-bold bg-gradient-to-r from-green-700 to-emerald-700 bg-clip-text text-transparent">
                Planificador Saludable
              </h1>
            </div>
            <p className="text-base md:text-lg text-green-800/80">Optimiza tus compras, come m√°s fresco y reduce el desperdicio.</p>

            <div className="flex flex-wrap justify-center gap-2 md:gap-3 mt-4">
              <button onClick={exportData} className="px-3 py-2 md:px-4 md:py-2 border rounded-lg border-emerald-300 hover:bg-emerald-100/50 hover:text-emerald-800 shadow-sm">
                ‚¨áÔ∏è Exportar Datos
              </button>
              <button onClick={onPickFile} className="px-3 py-2 md:px-4 md:py-2 border rounded-lg border-emerald-300 hover:bg-emerald-100/50 hover:text-emerald-800 shadow-sm">
                ‚¨ÜÔ∏è Importar Datos
              </button>
              <input ref={fileInputRef} type="file" accept=".json" className="hidden" onChange={onImportFile} />
              <button onClick={clearAll} className="px-3 py-2 md:px-4 md:py-2 border rounded-lg border-red-300 text-red-600 hover:bg-red-100/50 hover:text-red-700 shadow-sm">
                üóëÔ∏è Limpiar Todo
              </button>
            </div>
          </header>

          {/* Tabs compactos */}
          <div className="w-full">
            <div className="grid grid-cols-3 sm:grid-cols-6 gap-2 bg-white/60 backdrop-blur-sm rounded-xl p-2 shadow-inner mb-5">
              {['dashboard','lista','precios','inventario','plan','guia'].map(k => (
                <button
                  key={k}
                  onClick={() => setTab(k)}
                  className={
                    'px-3 py-2 rounded-lg text-sm font-medium ' +
                    (tab === k ? 'bg-white shadow text-emerald-700' : 'hover:bg-white/70 text-slate-700')
                  }>
                  {k === 'dashboard' && 'üìà Dashboard'}
                  {k === 'lista' && 'üõí Lista'}
                  {k === 'precios' && 'üí≤ Precios'}
                  {k === 'inventario' && 'üè† Inventario'}
                  {k === 'plan' && 'üóìÔ∏è Plan'}
                  {k === 'guia' && 'üçé Gu√≠a'}
                </button>
              ))}
            </div>

            {/* === Dashboard === */}
            {tab === 'dashboard' && (
              <div className="space-y-5">
                {/* M√©tricas compactas */}
                <div className="grid grid-cols-2 lg:grid-cols-4 gap-4">
                  <div className="bg-white/80 border border-blue-200 rounded-xl p-3 shadow-sm">
                    <div className="text-xs md:text-sm font-medium text-blue-800 mb-1">Presupuesto Semanal</div>
                    <div className="flex items-baseline gap-1 md:gap-2">
                      <span className="text-xl md:text-2xl font-bold text-blue-700">S/</span>
                      <input
                        type="number"
                        value={state.presupuesto}
                        onChange={(e) => saveState({ ...state, presupuesto: parseFloat(e.target.value) || 0 })}
                        className="text-2xl md:text-3xl font-bold bg-transparent border-0 p-0 h-auto focus:ring-0 focus:outline-none text-blue-900 w-24 md:w-28"
                      />
                    </div>
                  </div>

                  <div className="bg-white/80 border border-green-200 rounded-xl p-3 shadow-sm">
                    <div className="text-xs md:text-sm font-medium text-green-800 mb-1">Total Estimado</div>
                    <div className="text-2xl md:text-3xl font-bold text-green-700">{formatCurrency(calculateTotalEstimado())}</div>
                  </div>

                  <div className="bg-white/80 border border-orange-200 rounded-xl p-3 shadow-sm">
                    <div className="text-xs md:text-sm font-medium text-orange-800 mb-1">Gasto Real (7 d√≠as)</div>
                    <div className="text-2xl md:text-3xl font-bold text-orange-700">{formatCurrency(calculateGastoReal())}</div>
                  </div>

                  <div className="bg-white/80 border border-purple-200 rounded-xl p-3 shadow-sm">
                    <div className="text-xs md:text-sm font-medium text-purple-800 mb-1">Ahorro Estimado</div>
                    <div className="text-2xl md:text-3xl font-bold text-purple-700">{formatCurrency(ahorroEstimado)}</div>
                  </div>
                </div>

                <div className="grid grid-cols-1 lg:grid-cols-2 gap-4">
                  <div className="bg-white/80 backdrop-blur-sm shadow-sm rounded-xl p-3">
                    <div className="text-green-800 font-semibold mb-2">Gastos de los √öltimos 7 D√≠as</div>
                    <ChartCanvas type="line" data={chartDataLine} options={chartOptsLine} height={220} />
                  </div>

                  <div className="bg-white/80 backdrop-blur-sm shadow-sm rounded-xl p-3">
                    <div className="text-green-800 font-semibold mb-2">Gasto por Producto (colores naturales)</div>
                    <ChartCanvas type="bar" data={chartDataBar} options={chartOptsBar} height={220} />
                    {/* Interpretaci√≥n r√°pida */}
                    {topProductos.length > 0 && (
                      <div className="mt-3">
                        <div className="text-sm font-semibold text-slate-700 mb-1">Interpretaci√≥n r√°pida (Top):</div>
                        <ul className="text-sm text-slate-600 grid grid-cols-1 md:grid-cols-2 gap-x-6">
                          {topProductos.map(([prod, val]) => (
                            <li key={prod} className="flex items-center gap-2 py-0.5">
                              <span className="inline-block w-3 h-3 rounded" style={{background: getColorForProduct(prod, { chart: { ctx: document.createElement('canvas').getContext('2d'), chartArea: {top:0,bottom:16} } })}}></span>
                              <span className="truncate">{prod}</span>
                              <span className="ml-auto font-medium">{formatCurrency(val)}</span>
                            </li>
                          ))}
                        </ul>
                      </div>
                    )}
                  </div>
                </div>
              </div>
            )}

            {/* === Lista === */}
            {tab === 'lista' && (
              <div className="bg-white/70 backdrop-blur-sm shadow rounded-xl">
                <div className="p-4 border-b">
                  <div className="text-green-800 font-bold text-lg flex items-center gap-2">üõí Lista de Compras</div>
                  <div className="text-sm text-slate-600">Total estimado: <span className="font-bold text-green-700">{formatCurrency(totalEstimado)}</span></div>
                </div>
                <div className="p-4 overflow-x-auto">
                  <table className="w-full text-sm">
                    <thead>
                      <tr className="border-b-2 border-green-200">
                        <th className="p-3 text-left font-semibold text-green-800">Producto</th>
                        <th className="p-3 text-left font-semibold text-green-800">Cantidad</th>
                        <th className="p-3 text-left font-semibold text-green-800">Tienda Sugerida</th>
                        <th className="p-3 text-right font-semibold text-green-800">Precio/u Est.</th>
                        <th className="p-3 text-right font-semibold text-green-800">Subtotal</th>
                        <th className="p-3 text-center font-semibold text-green-800">Acci√≥n</th>
                      </tr>
                    </thead>
                    <tbody>
                      {state.listaCompras.map(item => {
                        const { tienda, precioUnitario } = findBestPrice(item.producto);
                        const subtotal = (Number(item.cantidad) || 0) * (Number(precioUnitario) || 0);
                        return (
                          <tr key={item.id} className="border-b border-green-100 hover:bg-green-100/50 transition-colors">
                            <td className="p-2">
                              <input value={item.producto} onChange={(e) => updateItem('listaCompras', item.id, 'producto', e.target.value)} className="border border-green-200 rounded px-2 py-1 w-40 md:w-48 focus:outline-none focus:ring-1 focus:ring-green-400"/>
                            </td>
                            <td className="p-2 w-28">
                              <input type="number" step="0.1" value={item.cantidad} onChange={(e) => updateItem('listaCompras', item.id, 'cantidad', parseFloat(e.target.value) || 0)} className="border border-green-200 rounded px-2 py-1 w-24 text-right focus:outline-none focus:ring-1 focus:ring-green-400"/>
                            </td>
                            <td className="p-3 text-green-700 font-medium">{tienda || 'N/A'}</td>
                            <td className="p-3 text-right">{precioUnitario ? formatCurrency(precioUnitario) : 'N/A'}</td>
                            <td className="p-3 text-right font-bold text-green-600">{formatCurrency(subtotal)}</td>
                            <td className="p-2 text-center">
                              <button onClick={() => deleteItem('listaCompras', item.id)} className="text-red-600 hover:text-red-800 px-2 py-1 rounded hover:bg-red-100">Eliminar</button>
                            </td>
                          </tr>
                        );
                      })}
                    </tbody>
                  </table>
                </div>
                <div className="p-4 border-t">
                  <button onClick={() => addItem('listaCompras', { producto: '', cantidad: 1 })} className="bg-green-600 hover:bg-green-700 text-white px-4 py-2 rounded shadow">
                    ‚ûï A√±adir Producto
                  </button>
                </div>
              </div>
            )}

            {/* === Precios === */}
            {tab === 'precios' && (
              <div className="bg-white/70 backdrop-blur-sm shadow rounded-xl">
                <div className="p-4 border-b">
                  <div className="text-green-800 font-bold text-lg flex items-center gap-2">üí≤ Registro de Precios</div>
                  <div className="text-sm text-slate-600">Registra tus compras para encontrar siempre los mejores precios y alimentar los gr√°ficos.</div>
                </div>
                <div className="p-4 overflow-x-auto">
                  <table className="w-full text-sm">
                    <thead className="border-b-2 border-green-200">
                      <tr>
                        <th className="p-3 text-left font-semibold text-green-800">Fecha</th>
                        <th className="p-3 text-left font-semibold text-green-800">Tienda</th>
                        <th className="p-3 text-left font-semibold text-green-800">Producto</th>
                        <th className="p-3 text-left font-semibold text-green-800">Unidad</th>
                        <th className="p-3 text-right font-semibold text-green-800">Cantidad</th>
                        <th className="p-3 text-right font-semibold text-green-800">Precio Total</th>
                        <th className="p-3 text-right font-semibold text-green-800">Precio/u</th>
                        <th className="p-3 text-center font-semibold text-green-800">Acci√≥n</th>
                      </tr>
                    </thead>
                    <tbody>
                      {state.precios.map(item => {
                        const precioUnitario = (Number(item.cantidad) > 0) ? (Number(item.precioTotal) || 0) / Number(item.cantidad) : 0;
                        return (
                          <tr key={item.id} className="border-b border-green-100 hover:bg-green-100/50 transition-colors">
                            <td className="p-2"><input type="date" value={item.fecha} onChange={(e) => updateItem('precios', item.id, 'fecha', e.target.value)} className="border border-green-200 rounded px-2 py-1 focus:outline-none focus:ring-1 focus:ring-green-400"/></td>
                            <td className="p-2"><input value={item.tienda} onChange={(e) => updateItem('precios', item.id, 'tienda', e.target.value)} className="border border-green-200 rounded px-2 py-1 focus:outline-none focus:ring-1 focus:ring-green-400"/></td>
                            <td className="p-2"><input value={item.producto} onChange={(e) => updateItem('precios', item.id, 'producto', e.target.value)} className="border border-green-200 rounded px-2 py-1 focus:outline-none focus:ring-1 focus:ring-green-400"/></td>
                            <td className="p-2 w-28"><input value={item.unidad} onChange={(e) => updateItem('precios', item.id, 'unidad', e.target.value)} className="border border-green-200 rounded px-2 py-1 focus:outline-none focus:ring-1 focus:ring-green-400"/></td>
                            <td className="p-2 w-28"><input type="number" step="0.1" value={item.cantidad} onChange={(e) => updateItem('precios', item.id, 'cantidad', parseFloat(e.target.value) || 0)} className="border border-green-200 rounded px-2 py-1 text-right focus:outline-none focus:ring-1 focus:ring-green-400"/></td>
                            <td className="p-2 w-28"><input type="number" step="0.01" value={item.precioTotal} onChange={(e) => updateItem('precios', item.id, 'precioTotal', parseFloat(e.target.value) || 0)} className="border border-green-200 rounded px-2 py-1 text-right focus:outline-none focus:ring-1 focus:ring-green-400"/></td>
                            <td className="p-3 text-right font-bold text-green-600">{formatCurrency(precioUnitario)}</td>
                            <td className="p-2 text-center"><button onClick={() => deleteItem('precios', item.id)} className="text-red-600 hover:text-red-800 px-2 py-1 rounded hover:bg-red-100">Eliminar</button></td>
                          </tr>
                        );
                      })}
                    </tbody>
                  </table>
                </div>
                <div className="p-4 border-t">
                  <button onClick={() => addItem('precios', { fecha: getTodayDate(), tienda: '', producto: '', unidad: 'kg', cantidad: 1, precioTotal: 0 })} className="bg-green-600 hover:bg-green-700 text-white px-4 py-2 rounded shadow">
                    ‚ûï A√±adir Compra
                  </button>
                </div>
              </div>
            )}

            {/* === Inventario === */}
            {tab === 'inventario' && (
              <div className="bg-white/70 backdrop-blur-sm shadow rounded-xl">
                <div className="p-4 border-b">
                  <div className="text-green-800 font-bold text-lg flex items-center gap-2">üè† Inventario en Casa</div>
                  <div className="text-sm text-slate-600">Lleva un control de lo que tienes para evitar comprar de m√°s y reducir el desperdicio.</div>
                </div>
                <div className="p-4 overflow-x-auto">
                  <table className="w-full text-sm">
                    <thead className="border-b-2 border-green-200">
                      <tr>
                        <th className="p-3 text-left font-semibold text-green-800">Producto</th>
                        <th className="p-3 text-left font-semibold text-green-800">Fecha de Compra</th>
                        <th className="p-3 text-left font-semibold text-green-800">Fecha de Vencimiento</th>
                        <th className="p-3 text-center font-semibold text-green-800">D√≠as Restantes</th>
                        <th className="p-3 text-center font-semibold text-green-800">Estado</th>
                        <th className="p-3 text-center font-semibold text-green-800">Acci√≥n</th>
                      </tr>
                    </thead>
                    <tbody>
                      {state.inventario.map(item => {
                        const days = getDaysRemaining(item.fechaVenc);
                        const pr = getPriorityInfo(days);
                        return (
                          <tr key={item.id} className="border-b border-green-100 hover:bg-green-100/50 transition-colors">
                            <td className="p-2"><input value={item.producto} onChange={(e) => updateItem('inventario', item.id, 'producto', e.target.value)} className="border border-green-200 rounded px-2 py-1 focus:outline-none focus:ring-1 focus:ring-green-400"/></td>
                            <td className="p-2"><input type="date" value={item.fechaCompra} onChange={(e) => updateItem('inventario', item.id, 'fechaCompra', e.target.value)} className="border border-green-200 rounded px-2 py-1 focus:outline-none focus:ring-1 focus:ring-green-400"/></td>
                            <td className="p-2"><input type="date" value={item.fechaVenc} onChange={(e) => updateItem('inventario', item.id, 'fechaVenc', e.target.value)} className="border border-green-200 rounded px-2 py-1 focus:outline-none focus:ring-1 focus:ring-green-400"/></td>
                            <td className="p-3 text-center font-bold">{isNaN(days) ? '-' : days}</td>
                            <td className="p-3 text-center">
                              <span className={'px-2 py-1 rounded-full text-xs font-semibold ' + pr.cls}>{pr.text}</span>
                            </td>
                            <td className="p-2 text-center"><button onClick={() => deleteItem('inventario', item.id)} className="text-red-600 hover:text-red-800 px-2 py-1 rounded hover:bg-red-100">Eliminar</button></td>
                          </tr>
                        );
                      })}
                    </tbody>
                  </table>
                </div>
                <div className="p-4 border-t">
                  <button onClick={() => addItem('inventario', { producto: '', fechaCompra: getTodayDate(), fechaVenc: getTodayDate() })} className="bg-green-600 hover:bg-green-700 text-white px-4 py-2 rounded shadow">
                    ‚ûï A√±adir a Inventario
                  </button>
                </div>
              </div>
            )}

            {/* === Plan Semanal === */}
            {tab === 'plan' && (
              <div className="bg-white/70 backdrop-blur-sm shadow rounded-xl">
                <div className="p-4 border-b">
                  <div className="text-green-800 font-bold text-lg flex items-center gap-2">üóìÔ∏è Plan de Comidas Semanal</div>
                  <div className="text-sm text-slate-600">Organiza tus comidas para saber exactamente qu√© necesitas comprar.</div>
                </div>
                <div className="p-4 overflow-x-auto">
                  <table className="w-full text-sm">
                    <thead className="border-b-2 border-green-200">
                      <tr>
                        <th className="p-3 text-left font-semibold text-green-800">D√≠a</th>
                        <th className="p-3 text-left font-semibold text-green-800">Desayuno</th>
                        <th className="p-3 text-left font-semibold text-green-800">Almuerzo</th>
                        <th className="p-3 text-left font-semibold text-green-800">Snacks</th>
                      </tr>
                    </thead>
                    <tbody>
                      {Object.entries(state.planSemanal).map(([dia, comidas]) => (
                        <tr key={dia} className="border-b border-green-100 hover:bg-green-100/50 transition-colors">
                          <td className="p-3 font-bold text-green-700">{dia}</td>
                          <td className="p-2"><input value={comidas.desayuno} onChange={(e) => {
                            const p = { ...state.planSemanal, [dia]: { ...comidas, desayuno: e.target.value } };
                            saveState({ ...state, planSemanal: p });
                          }} className="border border-green-200 rounded px-2 py-1 focus:outline-none focus:ring-1 focus:ring-green-400"/></td>
                          <td className="p-2"><input value={comidas.almuerzo} onChange={(e) => {
                            const p = { ...state.planSemanal, [dia]: { ...comidas, almuerzo: e.target.value } };
                            saveState({ ...state, planSemanal: p });
                          }} className="border border-green-200 rounded px-2 py-1 focus:outline-none focus:ring-1 focus:ring-green-400"/></td>
                          <td className="p-2"><input value={comidas.snacks} onChange={(e) => {
                            const p = { ...state.planSemanal, [dia]: { ...comidas, snacks: e.target.value } };
                            saveState({ ...state, planSemanal: p });
                          }} className="border border-green-200 rounded px-2 py-1 focus:outline-none focus:ring-1 focus:ring-green-400"/></td>
                        </tr>
                      ))}
                    </tbody>
                  </table>
                </div>
              </div>
            )}

            {/* === Gu√≠a === */}
            {tab === 'guia' && (
              <div className="bg-white/70 backdrop-blur-sm shadow rounded-xl p-6 space-y-6">
                <div className="flex gap-4">
                  <div className="text-2xl">üå±</div>
                  <div>
                    <h3 className="font-bold text-lg text-green-800">Planifica tus Comidas</h3>
                    <p className="text-slate-600">Antes de ir a comprar, decide qu√© vas a comer durante la semana. As√≠ comprar√°s solo lo necesario.</p>
                  </div>
                </div>
                <div className="flex gap-4">
                  <div className="text-2xl">üßä</div>
                  <div>
                    <h3 className="font-bold text-lg text-blue-800">Almacenamiento Inteligente</h3>
                    <p className="text-slate-600">Guarda las verduras de hoja con una toalla de papel para absorber la humedad. Mant√©n los tomates y pl√°tanos fuera del refrigerador.</p>
                  </div>
                </div>
                <div className="flex gap-4">
                  <div className="text-2xl">üí°</div>
                  <div>
                    <h3 className="font-bold text-lg text-yellow-800">Compra de Temporada</h3>
                    <p className="text-slate-600">Los productos de temporada no solo son m√°s baratos, sino tambi√©n m√°s frescos y sabrosos. ¬°Investiga qu√© est√° de temporada en tu zona!</p>
                  </div>
                </div>
                <div className="flex gap-4">
                  <div className="text-2xl">‚ú®</div>
                  <div>
                    <h3 className="font-bold text-lg text-purple-800">Reduce el Desperdicio</h3>
                    <p className="text-slate-600">Usa los tallos de br√≥coli o las hojas de zanahoria para caldos. Congela frutas muy maduras para batidos.</p>
                  </div>
                </div>
              </div>
            )}
          </div>
        </div>
      );
    }

    const root = ReactDOM.createRoot(document.getElementById('root'));
    root.render(<App />);
  </script>
</body>
</html>
"""
with open('/mnt/data/planificador_compras_colores.html', 'w', encoding='utf-8') as f:
    f.write(html)

print("Archivo HTML con colores por producto generado: /mnt/data/planificador_compras_colores.html")
